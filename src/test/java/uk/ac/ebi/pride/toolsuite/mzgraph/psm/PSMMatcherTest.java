package uk.ac.ebi.pride.toolsuite.mzgraph.psm;

import org.junit.Test;
import uk.ac.ebi.pride.utilities.iongen.model.PeakSet;
import uk.ac.ebi.pride.utilities.iongen.model.PrecursorIon;
import uk.ac.ebi.pride.utilities.iongen.impl.DefaultPrecursorIon;
import uk.ac.ebi.pride.utilities.mol.NeutralLoss;
import uk.ac.ebi.pride.utilities.mol.PTModification;
import uk.ac.ebi.pride.utilities.mol.Peptide;
import uk.ac.ebi.pride.utilities.mol.ProductIonPair;
import uk.ac.ebi.pride.utilities.iongen.ion.FragmentIonType;
import uk.ac.ebi.pride.toolsuite.mzgraph.chart.data.annotation.IonAnnotation;
import uk.ac.ebi.pride.toolsuite.mzgraph.chart.data.annotation.IonAnnotationInfo;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static junit.framework.Assert.assertTrue;

/**
 * Creator: Qingwei-XU
 * Date: 23/11/12
 */

public class PSMMatcherTest {
    private PSMMatcher matcher = PSMMatcher.getInstance();

    private int getOffset(int charge, NeutralLoss loss, int precursorCharge) {
        if (precursorCharge > 3) {
            precursorCharge = 3;
        }

        if (charge > precursorCharge) {
            return -1;
        }

        if (loss == null) {
            return charge;
        } else if (loss == NeutralLoss.AMMONIA_LOSS) {
            return precursorCharge + charge;
        } else {
            return 2 * precursorCharge + charge;
        }
    }

    public int getColumnNumber(int precursorCharge, FragmentIonType type, int charge, NeutralLoss loss, int columnCount) {
        int offset = getOffset(charge, loss, precursorCharge);

        if (type.equals(FragmentIonType.X_ION) || type.equals(FragmentIonType.Y_ION) || type.equals(FragmentIonType.Z_ION)) {
            return offset;
        } else if (type.equals(FragmentIonType.A_ION) || type.equals(FragmentIonType.B_ION) || type.equals(FragmentIonType.C_ION)) {
            return columnCount / 2 + offset;
        } else {
            return -1;
        }
    }

    public int getRowNumber(FragmentIonType type, int location, int rowCount) {
        int row = -1;

        if (type.equals(FragmentIonType.X_ION) || type.equals(FragmentIonType.Y_ION) || type.equals(FragmentIonType.Z_ION)) {
            row = rowCount - location - 1;
        } else if (type.equals(FragmentIonType.A_ION) || type.equals(FragmentIonType.B_ION) || type.equals(FragmentIonType.C_ION)) {
            row = location;
        }

        return row;
    }

    private void testMatcher(PrecursorIon precursorIon, PeakSet peaks) {
        testMatcher(precursorIon, ProductIonPair.B_Y, peaks);
    }

    private void testMatcher(PrecursorIon precursorIon, ProductIonPair ionPair, PeakSet peaks) {
        IonAnnotation[][] annotations =  matcher.match(precursorIon, ionPair, peaks);

        IonAnnotationInfo info;
        IonAnnotationInfo.Item item;
        for (int row = 0; row < annotations.length; row++) {
            for (int col = 0; col < annotations[row].length; col++) {
                if (annotations[row][col] != null) {
                    info = annotations[row][col].getAnnotationInfo();
                    if (info != null) {
                        assertTrue(info.getNumberOfItems() == 1);

                        item = info.getItem(0);
                        int annotationRow = getRowNumber(item.getType(), item.getLocation(), annotations.length);
                        int annotationCol = getColumnNumber(precursorIon.getCharge(), item.getType(), item.getCharge(), item.getNeutralLoss(), annotations[0].length);

                        assertTrue(annotationRow == row);
                        assertTrue(annotationCol == col);
                    }
                }
            }
        }
    }

    @Test
    public void testPeptide() {
        PrecursorIon precursorIon = new DefaultPrecursorIon("VVSVLTVLHQDWLNGK", 2);

        double[] mzArray = {296.14764404296875,297.8748779296875,299.8394775390625,301.9700927734375,313.1361083984375,318.13177490234375,319.06524658203125,321.8583984375,324.0738525390625,346.1568603515625,347.647705078125,352.64306640625,364.8765869140625,367.04449462890625,368.3057861328125,379.1202392578125,381.1158447265625,383.120849609375,395.15576171875,399.054443359375,431.1387939453125,432.7166748046875,452.03759765625,464.1614990234375,467.65277099609375,468.3175048828125,477.6627197265625,480.1109619140625,482.14892578125,482.8671875,496.13037109375,498.61944580078125,499.25299072265625,500.15936279296875,511.4937744140625,518.9674072265625,522.1351318359375,523.444580078125,530.2315673828125,532.186767578125,532.89404296875,542.7333984375,546.4239501953125,548.884521484375,550.0625,553.5577392578125,562.949951171875,567.662109375,578.1263427734375,579.1461181640625,580.9564208984375,581.797607421875,594.943603515625,600.254150390625,607.177978515625,609.4302978515625,612.97265625,615.19775390625,617.135009765625,618.16259765625,619.437744140625,642.97412109375,646.497802734375,647.28515625,653.9801025390625,655.803955078125,662.205078125,664.173583984375,665.3328857421875,672.17236328125,676.257080078125,677.22119140625,680.03662109375,681.35302734375,694.3941650390625,695.2271728515625,697.050048828125,698.04150390625,701.40380859375,716.0185546875,720.319580078125,725.052978515625,727.874755859375,732.268310546875,733.448486328125,745.466064453125,750.5518798828125,775.48193359375,776.29736328125,781.940673828125,787.103759765625,793.29833984375,803.08154296875,806.0294189453125,807.6246337890625,810.1236572265625,811.0411376953125,825.2757568359375,834.2576904296875,841.4625244140625,843.5106201171875,844.3162841796875,853.0150146484375,855.2154541015625,860.614013671875,861.3262939453125,870.3343505859375,877.4801025390625,887.431640625,919.0341796875,921.4595947265625,926.7269287109375,930.07958984375,932.7298583984375,933.7288818359375,939.450927734375,940.2603759765625,948.3387451171875,949.336669921875,950.6212158203125,955.6859130859375,961.4154052734375,962.5234375,963.4901123046875,964.47021484375,965.6632080078125,967.062744140625,970.1131591796875,979.478271484375,980.43408203125,982.78759765625,984.25341796875,989.6199951171875,996.5858154296875,997.367919921875,998.3538818359375,999.465576171875,1046.85498046875,1053.76220703125,1076.53955078125,1077.896484375,1092.36669921875,1093.445556640625,1094.3232421875,1095.625244140625,1110.54150390625,1111.474609375,1112.5283203125,1132.6220703125,1150.483642578125,1151.37353515625,1162.3681640625,1177.922119140625,1178.888671875,1179.63134765625,1191.5478515625,1192.351806640625,1193.48583984375,1209.42529296875,1210.769287109375,1211.79150390625,1220.52685546875,1230.4716796875,1254.25830078125,1293.052734375,1293.679931640625,1294.510498046875,1310.67626953125,1311.56591796875,1312.462158203125,1342.11962890625,1349.5771484375,1350.6845703125,1377.569580078125,1379.4453125,1381.729248046875,1405.443359375,1406.44970703125,1407.2138671875,1423.671142578125,1424.708984375,1455.453369140625,1464.211181640625,1473.658447265625,1476.03076171875,1488.60498046875,1490.8076171875,1491.693359375,1505.753662109375,1524.13232421875,1573.6689453125,1592.799560546875,1593.594482421875,1604.56396484375,1605.345458984375,1606.278076171875,1606.979248046875,1609.817138671875,1610.905517578125,1644.198974609375};
        double[] intensityArray = {3611.0,1156.0,9668.0,2645.0,2961.0,12209.0,875.0,986.0,767.0,2061.0,20026.0,2198.0,1074.0,3253.0,1370.0,1463.0,3317.0,1318.0,3779.0,1382.0,1342.0,936.0,3586.0,4944.0,6084.0,3037.0,727.0,6786.0,3240.0,1630.0,942.0,9697.0,1273.0,2490.0,1947.0,2909.0,434.0,16993.0,712.0,9431.0,639.0,3693.0,8663.0,6894.0,749.0,4510.0,3342.0,531.0,2087.0,5130.0,22315.0,2056.0,11536.0,2427.0,704.0,2194.0,1333.0,10399.0,8779.0,8811.0,553.0,2309.0,998.0,1411.0,1042.0,2060.0,3358.0,3384.0,1679.0,1618.0,4762.0,2262.0,7766.0,3459.0,6006.0,734.0,1611.0,3043.0,667.0,3381.0,1107.0,3633.0,2433.0,17853.0,4053.0,664.0,338.0,1928.0,1433.0,1236.0,4079.0,3612.0,2888.0,1634.0,2068.0,2203.0,6761.0,1682.0,972.0,752.0,7147.0,16602.0,9579.0,4247.0,10715.0,1139.0,4267.0,2610.0,1468.0,1273.0,4544.0,1758.0,2251.0,368.0,1751.0,13980.0,1.0,7749.0,4605.0,2191.0,2154.0,2246.0,4553.0,3200.0,931.0,2500.0,1540.0,366.0,3012.0,4868.0,1718.0,2646.0,6779.0,565.0,21549.0,18580.0,3410.0,2220.0,4896.0,5441.0,2125.0,2644.0,10501.0,2831.0,1029.0,42432.0,11147.0,10253.0,1976.0,2841.0,491.0,910.0,10643.0,6930.0,1091.0,9795.0,7461.0,1672.0,7712.0,16224.0,415.0,1003.0,1628.0,955.0,11707.0,2673.0,2534.0,13649.0,12289.0,6483.0,1008.0,1713.0,681.0,809.0,500.0,660.0,1796.0,2358.0,1593.0,5477.0,3291.0,6626.0,1665.0,1194.0,1340.0,2123.0,12565.0,5261.0,848.0,1346.0,2252.0,3696.0,4031.0,4237.0,398.0,10375.0,7542.0,1077.0,7972.0,0.0};

        PeakSet peakSet = PeakSet.getInstance(mzArray, intensityArray);
        testMatcher(precursorIon, peakSet);
    }

    @Test
    public void testPTMPeptide() {
        List<Double> monoMassList = new ArrayList<Double>();
        monoMassList.add(15.994915);
        List<Double> avgMassList = new ArrayList<Double>();
        avgMassList.add(16.0);
        PTModification modification = new PTModification("oxidation", null, "MOD:00412", monoMassList, avgMassList);
        Map<Integer, PTModification> ptm = new HashMap<Integer, PTModification>();
        ptm.put(19, modification);
        Peptide peptide = new Peptide("RVAEGTQVLELPFKGDDITMVLILPKPEK", ptm);
        PrecursorIon precursorIon = new DefaultPrecursorIon(peptide, 2);

        double[] mzArray = {323.15673828125,327.81884765625,337.17828369140625,339.07958984375,355.17822265625,360.95751953125,373.171142578125,374.10870361328125,379.94793701171875,383.42242431640625,398.0423583984375,407.45074462890625,408.85821533203125,411.318359375,420.07537841796875,430.30413818359375,435.96173095703125,439.00238037109375,440.58123779296875,443.9097900390625,449.877685546875,456.12017822265625,457.28857421875,458.10235595703125,460.9007568359375,469.13067626953125,483.17767333984375,497.15771484375,501.061767578125,502.36529541015625,513.43408203125,515.043212890625,523.654052734375,528.033203125,529.273681640625,531.258056640625,537.171630859375,541.6234130859375,542.29833984375,545.1015625,546.033447265625,549.73486328125,554.9775390625,557.216064453125,559.3095703125,565.36376953125,568.0936279296875,570.1734619140625,578.08154296875,580.09423828125,580.8970947265625,583.5716552734375,586.2864990234375,588.0302734375,596.4075927734375,597.626708984375,598.3160400390625,599.214599609375,600.16455078125,606.17041015625,610.805908203125,612.03662109375,613.290283203125,616.7398681640625,623.336669921875,630.212646484375,643.62353515625,656.3822021484375,657.147216796875,657.749755859375,659.21826171875,660.31787109375,661.298095703125,666.376708984375,677.757080078125,682.43701171875,684.098388671875,685.678466796875,687.357666015625,694.072021484375,696.3092041015625,698.0224609375,704.1600341796875,710.35693359375,711.41259765625,712.385009765625,713.27197265625,714.45556640625,721.26123046875,723.047607421875,725.503173828125,726.211181640625,730.7138671875,735.507568359375,740.058837890625,742.288330078125,743.221923828125,744.5625,745.92138671875,754.123046875,755.326904296875,755.9765625,757.480224609375,758.2900390625,759.636962890625,761.744140625,764.228515625,770.3157958984375,773.37548828125,774.156005859375,776.165771484375,781.3275146484375,783.1845703125,790.544189453125,791.2647705078125,796.4013671875,803.4158935546875,804.372314453125,805.13330078125,807.176025390625,812.1842041015625,812.9281005859375,813.6900634765625,814.48779296875,815.4349365234375,821.9161376953125,824.359130859375,825.652099609375,834.2572021484375,841.4757080078125,842.2430419921875,858.403076171875,865.1319580078125,867.4278564453125,871.222900390625,872.3935546875,875.0909423828125,876.2445068359375,877.348876953125,879.7041015625,884.2120361328125,887.516845703125,889.0860595703125,892.523681640625,893.347900390625,896.4132080078125,897.681884765625,899.0078125,903.244140625,906.9371337890625,908.2657470703125,909.70947265625,911.2509765625,912.440673828125,914.597900390625,920.42236328125,921.4359130859375,923.4068603515625,925.40283203125,926.880859375,928.03857421875,928.7607421875,929.6048583984375,937.308837890625,938.134765625,939.5523681640625,940.546630859375,945.3824462890625,947.2652587890625,953.2547607421875,954.404296875,955.3094482421875,956.3953857421875,957.669189453125,966.2196044921875,970.1044921875,975.5728759765625,981.4234619140625,982.5684814453125,987.864013671875,988.48876953125,990.482421875,997.291748046875,999.364990234375,1000.279541015625,1000.9583740234375,1001.8682861328125,1003.52685546875,1004.360595703125,1011.1265869140625,1012.4971923828125,1013.984130859375,1015.326171875,1017.8172607421875,1018.5848388671875,1020.180908203125,1021.536865234375,1022.5274658203125,1023.43017578125,1029.425048828125,1030.22998046875,1032.7197265625,1034.24072265625,1036.5849609375,1037.40380859375,1038.576904296875,1039.57568359375,1040.532958984375,1041.3310546875,1042.837890625,1044.241455078125,1045.748779296875,1048.365966796875,1052.14501953125,1054.501708984375,1055.5126953125,1056.5595703125,1057.566650390625,1058.4287109375,1063.99072265625,1064.88037109375,1066.4677734375,1067.55126953125,1073.775146484375,1077.2861328125,1078.23095703125,1083.88525390625,1099.063232421875,1100.6455078125,1101.633544921875,1102.78857421875,1107.4013671875,1108.6708984375,1109.73583984375,1112.69580078125,1119.513427734375,1120.447509765625,1121.24169921875,1128.091552734375,1128.9365234375,1132.25439453125,1134.2158203125,1136.2666015625,1138.873046875,1144.6923828125,1146.0771484375,1151.56982421875,1152.485595703125,1153.48583984375,1155.75048828125,1160.3662109375,1161.35302734375,1164.1494140625,1167.11865234375,1169.4072265625,1170.02294921875,1170.7490234375,1171.427490234375,1176.1416015625,1178.03759765625,1179.47900390625,1180.572998046875,1181.4091796875,1183.385009765625,1184.15185546875,1185.79541015625,1187.35693359375,1195.93701171875,1196.61279296875,1197.6171875,1198.5029296875,1199.80322265625,1201.416015625,1203.523193359375,1205.70751953125,1206.9677734375,1208.482421875,1212.32861328125,1215.233642578125,1216.600341796875,1217.91162109375,1220.93408203125,1222.13671875,1225.0859375,1226.224365234375,1228.589599609375,1230.300048828125,1231.057861328125,1233.68896484375,1234.6123046875,1235.60205078125,1237.66064453125,1239.5126953125,1240.57470703125,1241.20361328125,1241.85498046875,1246.346923828125,1253.29833984375,1257.7587890625,1258.40673828125,1265.611328125,1271.87158203125,1272.720703125,1273.5,1280.57421875,1282.827392578125,1283.46337890625,1285.14501953125,1285.8369140625,1286.56298828125,1296.70654296875,1297.333251953125,1298.56884765625,1299.826171875,1305.89794921875,1311.58056640625,1313.8662109375,1314.9423828125,1315.826416015625,1318.2607421875,1321.054931640625,1321.66650390625,1328.4462890625,1329.737548828125,1330.634765625,1333.55712890625,1334.548583984375,1343.768310546875,1344.95166015625,1346.38525390625,1347.452392578125,1350.229736328125,1363.2568359375,1366.390380859375,1367.20068359375,1367.9296875,1373.2861328125,1379.48486328125,1380.436279296875,1384.18896484375,1395.357421875,1396.375,1397.634765625,1399.035888671875,1400.20947265625,1400.883056640625,1402.282958984375,1403.294677734375,1409.064208984375,1413.7275390625,1416.4287109375,1417.731689453125,1419.260498046875,1424.794189453125,1433.653564453125,1434.74853515625,1440.31884765625,1441.460693359375,1442.53076171875,1446.46630859375,1448.638671875,1449.25146484375,1459.040283203125,1459.716064453125,1460.775390625,1461.696533203125,1475.98828125,1477.814697265625,1484.36669921875,1491.361572265625,1493.7744140625,1495.79931640625,1508.6982421875,1509.65087890625,1512.55517578125,1513.4765625,1514.57568359375,1522.000732421875,1525.43505859375,1533.750732421875,1542.53759765625,1548.955810546875,1552.075439453125,1553.65771484375,1558.664794921875,1560.396728515625,1565.00830078125,1565.619873046875,1566.867919921875,1568.506591796875,1569.806640625,1571.009521484375,1573.61328125,1576.8896484375,1586.5869140625,1588.56884765625,1620.584228515625,1621.619140625,1622.642578125,1627.49609375,1628.56640625,1638.511962890625,1647.791015625,1666.3642578125,1667.324462890625,1668.426513671875,1669.96728515625,1682.08056640625,1683.888427734375,1684.914794921875,1685.7421875,1686.669921875,1687.861328125,1701.851806640625,1702.761474609375,1703.8818359375,1708.658203125,1733.7744140625,1741.938232421875,1748.583984375,1749.709228515625,1750.736572265625,1751.6318359375,1752.8720703125,1760.97802734375,1789.134521484375,1797.29638671875,1812.90234375,1814.72021484375,1843.7705078125,1856.747314453125,1858.024658203125,1882.739013671875,1895.108642578125,1895.862548828125,1910.788330078125,1926.19287109375,1928.590576171875,1959.662841796875,1969.720703125,1970.40625,1971.88330078125,1993.025634765625,1994.165283203125,1995.633544921875};
        double[] intensityArray = {11179.0,47412.0,3637.0,32071.0,1225.0,1349.0,34082.0,1902.0,16180.0,1022.0,4588.0,2072.0,7221.0,2046.0,8779.0,2421.0,5280.0,5979.0,9093.0,6518.0,1376.0,23320.0,11815.0,3951.0,12035.0,3886.0,2659.0,10960.0,4306.0,1154.0,14355.0,19659.0,7224.0,6107.0,18115.0,6525.0,1546.0,508.0,5923.0,2382.0,2747.0,22089.0,3973.0,8534.0,472.0,10659.0,5400.0,4199.0,4282.0,11970.0,11679.0,3862.0,1641.0,7803.0,5194.0,24961.0,51255.0,15045.0,462.0,3502.0,6954.0,3470.0,10180.0,4857.0,3155.0,2605.0,7051.0,2900.0,3273.0,14208.0,2952.0,17087.0,9117.0,1664.0,2806.0,4203.0,5389.0,1010.0,31779.0,3972.0,6952.0,7485.0,761.0,5790.0,59743.0,31671.0,13494.0,8415.0,21649.0,21489.0,7749.0,2751.0,11084.0,5083.0,2033.0,29415.0,22402.0,8310.0,3500.0,9332.0,5688.0,4371.0,5666.0,5418.0,7761.0,2965.0,1923.0,11717.0,31159.0,7615.0,18180.0,687.0,4719.0,3183.0,9964.0,10935.0,1833.0,18379.0,1.0,2905.0,2353.0,1695.0,40639.0,4858.0,3225.0,3951.0,33867.0,12917.0,1217.0,54920.0,4924.0,5196.0,9349.0,5951.0,63844.0,16520.0,11202.0,5574.0,10239.0,7714.0,3885.0,3718.0,15247.0,3491.0,6632.0,11390.0,3537.0,2170.0,24695.0,12633.0,1310.0,20910.0,34264.0,4566.0,28747.0,785.0,16999.0,20645.0,6288.0,38219.0,25968.0,7756.0,23529.0,9111.0,43078.0,6112.0,14906.0,1997.0,1727.0,10680.0,75735.0,42807.0,27124.0,9046.0,3698.0,11841.0,5062.0,12567.0,4006.0,9588.0,3.0,4218.0,31428.0,2395.0,29423.0,26612.0,6248.0,4146.0,15651.0,1955.0,2315.0,2707.0,1335.0,21742.0,14972.0,11110.0,24055.0,353.0,15896.0,23549.0,23239.0,3325.0,2152.0,12800.0,21809.0,24699.0,5296.0,18048.0,1657.0,22017.0,12471.0,23301.0,19648.0,17045.0,3469.0,10920.0,12628.0,8109.0,9051.0,83409.0,13175.0,18642.0,18514.0,4129.0,36176.0,60316.0,1574.0,11916.0,13020.0,22043.0,3215.0,36041.0,1451.0,2444.0,5449.0,3308.0,47129.0,6888.0,19467.0,1200.0,15826.0,2079.0,9131.0,18967.0,4681.0,6836.0,10485.0,5921.0,1493.0,10373.0,24061.0,11918.0,18057.0,3316.0,33352.0,1540.0,7358.0,320.0,21067.0,10995.0,21111.0,7796.0,876.0,13235.0,1477.0,9512.0,11713.0,19005.0,262585.0,186687.0,20383.0,11900.0,8009.0,14942.0,12401.0,337.0,1936.0,15513.0,34830.0,819.0,22546.0,8363.0,1765.0,10515.0,10176.0,7884.0,7048.0,1414.0,15732.0,17522.0,11500.0,19322.0,18278.0,12915.0,5545.0,1808.0,7884.0,3027.0,15712.0,550.0,22880.0,33351.0,87852.0,2.0,5311.0,25775.0,4154.0,31506.0,7609.0,9213.0,28748.0,1.0,28288.0,10604.0,20148.0,3217.0,1082.0,15692.0,6336.0,1070.0,22701.0,1.0,52086.0,64460.0,7563.0,2125.0,11317.0,7528.0,3689.0,10400.0,28413.0,1402.0,8295.0,7251.0,9104.0,39141.0,2422.0,12520.0,2266.0,1209.0,31991.0,7924.0,18108.0,51157.0,10084.0,836.0,15551.0,11455.0,1854.0,4066.0,1393.0,3099.0,660.0,8623.0,1781.0,6888.0,62134.0,43918.0,15404.0,4684.0,9881.0,8834.0,6736.0,42769.0,35544.0,32298.0,14802.0,3273.0,1082.0,4875.0,1631.0,2228.0,1308.0,16423.0,37454.0,18538.0,9057.0,5663.0,937.0,11390.0,9135.0,10727.0,5716.0,23101.0,24756.0,2183.0,4845.0,3735.0,4799.0,11792.0,33447.0,25013.0,14002.0,8175.0,10098.0,2646.0,36071.0,40530.0,8701.0,10836.0,12786.0,6390.0,570.0,2893.0,4089.0,2125.0,19718.0,9084.0,12319.0,16825.0,9969.0,3222.0,4758.0,10587.0,902.0,8194.0,1075.0,9306.0,18583.0,12163.0,6186.0,3120.0,5092.0,5345.0,6715.0,905.0,4922.0,6942.0,12962.0,12198.0,3316.0,26838.0,12022.0,6833.0,4129.0,4350.0,2638.0,9893.0,20745.0,6505.0,1935.0,4550.0,17772.0,9502.0,0.0};

        PeakSet peakSet = PeakSet.getInstance(mzArray, intensityArray);
        testMatcher(precursorIon, peakSet);
    }

    @Test
    public void testPeptideWithProductIonPair() {
        PrecursorIon precursorIon = new DefaultPrecursorIon("VAEGTQVLELPFKGDDITMVLILPKPEK", 2);
        double[] mzArray = {301.629638671875,305.1085205078125,309.20477294921875,311.2861328125,320.97601318359375,326.42022705078125,332.3282470703125,334.0474853515625,337.18170166015625,345.99652099609375,354.84912109375,355.48809814453125,364.644775390625,367.85565185546875,369.358642578125,373.140625,374.09991455078125,384.0521240234375,386.01641845703125,394.8807373046875,397.841064453125,409.113525390625,411.27862548828125,412.091064453125,415.63922119140625,434.1004638671875,435.59808349609375,437.24530029296875,439.5865478515625,441.20819091796875,450.09075927734375,450.72479248046875,451.5618896484375,452.5006103515625,453.53875732421875,455.90252685546875,457.013427734375,458.07196044921875,466.043212890625,469.5479736328125,470.45416259765625,476.42303466796875,479.1356201171875,480.90631103515625,483.4765625,485.3941650390625,497.3031005859375,498.18096923828125,501.20989990234375,515.068603515625,521.2744140625,526.13623046875,529.292724609375,530.3404541015625,531.2381591796875,532.312744140625,539.25439453125,540.279541015625,543.0755615234375,544.51611328125,546.44482421875,551.959228515625,552.989013671875,553.9417724609375,558.767333984375,560.2333984375,564.577880859375,567.06591796875,568.16357421875,569.367919921875,573.611328125,580.260986328125,580.8729248046875,583.5926513671875,586.1966552734375,593.5400390625,596.202392578125,597.1387939453125,598.316162109375,599.30517578125,600.51904296875,608.42333984375,610.0577392578125,611.317138671875,614.056640625,622.279541015625,628.396728515625,630.546142578125,632.163330078125,637.2713623046875,645.2423095703125,649.28955078125,652.1123046875,654.130859375,657.029541015625,658.179443359375,660.1903076171875,661.099365234375,664.361083984375,665.26953125,666.249267578125,667.1341552734375,668.73974609375,669.3896484375,678.2354736328125,680.1318359375,681.40966796875,683.3011474609375,691.9012451171875,693.507080078125,696.5921630859375,699.233642578125,700.328125,708.944091796875,710.8282470703125,711.453369140625,712.2335205078125,713.0006103515625,716.3089599609375,717.271240234375,721.438720703125,726.9403076171875,727.867919921875,738.3426513671875,739.0511474609375,741.1241455078125,742.01123046875,742.681640625,745.044921875,747.3212890625,748.5107421875,749.8212890625,751.3839111328125,754.23291015625,756.156982421875,757.4188232421875,758.154052734375,760.3125,760.9580078125,763.1279296875,766.3519287109375,769.099609375,773.318603515625,774.427734375,775.51806640625,778.332763671875,780.2017822265625,781.78271484375,782.4298095703125,785.44775390625,787.8389892578125,791.1185302734375,791.74365234375,793.921630859375,798.72021484375,799.404541015625,800.393798828125,801.0804443359375,807.2275390625,808.0946044921875,809.5726318359375,810.9969482421875,813.539306640625,814.401123046875,822.2652587890625,824.354248046875,825.3975830078125,826.232666015625,828.3245849609375,829.3065185546875,830.88232421875,835.3651123046875,836.2662353515625,837.5484619140625,839.315673828125,841.595458984375,842.5667724609375,846.135498046875,847.4388427734375,849.4298095703125,851.0577392578125,852.14013671875,853.9244384765625,854.9752197265625,856.433349609375,857.7186279296875,858.7626953125,860.51904296875,864.2835693359375,866.8768310546875,870.2279052734375,872.322021484375,874.01806640625,875.7730712890625,881.3062744140625,884.835205078125,886.466552734375,887.5189208984375,888.2645263671875,890.5780029296875,891.3394775390625,892.3460693359375,893.2490234375,893.88818359375,896.20751953125,897.6033935546875,899.4073486328125,900.3892822265625,903.4202880859375,905.92578125,907.1290283203125,908.6142578125,909.352783203125,910.1417236328125,915.4923095703125,916.680419921875,919.6810302734375,923.1485595703125,924.19287109375,926.104736328125,927.56396484375,928.5303955078125,934.8843994140625,937.3634033203125,938.5401611328125,939.343994140625,941.2647705078125,943.112060546875,946.0816650390625,948.43310546875,949.6824951171875,951.616455078125,952.5421142578125,955.3697509765625,956.3895263671875,958.20654296875,962.018798828125,963.27392578125,964.18603515625,965.37841796875,967.6435546875,969.347412109375,971.0858154296875,971.952880859375,973.129638671875,976.4493408203125,977.68212890625,978.628662109375,979.3179931640625,982.089111328125,984.1329345703125,985.532470703125,987.6839599609375,988.42236328125,991.432861328125,992.48388671875,994.6429443359375,995.5926513671875,996.6553955078125,997.4862060546875,998.7105712890625,1000.4217529296875,1001.9595947265625,1004.5628662109375,1005.6204833984375,1006.33837890625,1013.552490234375,1014.3565673828125,1015.3179931640625,1021.2921142578125,1022.207763671875,1023.2340087890625,1036.483642578125,1037.6552734375,1038.33984375,1040.4677734375,1041.86328125,1042.94287109375,1044.419189453125,1050.392578125,1053.455322265625,1056.51318359375,1058.57763671875,1064.485107421875,1068.43408203125,1070.64697265625,1072.15087890625,1072.94140625,1074.0322265625,1076.270263671875,1078.1474609375,1078.970703125,1079.79248046875,1080.4765625,1084.61572265625,1086.7919921875,1092.461669921875,1093.1474609375,1098.38623046875,1099.302734375,1101.041748046875,1104.5166015625,1105.384765625,1110.92431640625,1111.72265625,1112.785888671875,1116.4072265625,1117.22607421875,1118.13232421875,1119.44287109375,1120.04345703125,1126.062255859375,1129.294677734375,1133.46728515625,1134.792236328125,1137.1591796875,1138.41455078125,1142.68896484375,1153.380126953125,1154.449951171875,1155.43017578125,1156.760009765625,1166.75634765625,1168.224609375,1169.67822265625,1171.4775390625,1175.40185546875,1176.94970703125,1178.14111328125,1183.46435546875,1184.83349609375,1185.69677734375,1186.38037109375,1187.14306640625,1189.48193359375,1193.302734375,1198.88623046875,1199.81689453125,1200.47900390625,1201.6943359375,1203.20263671875,1204.71630859375,1212.070068359375,1214.36767578125,1217.4794921875,1218.440185546875,1226.22509765625,1227.853515625,1228.8935546875,1229.664794921875,1233.56298828125,1240.3369140625,1243.463623046875,1248.416015625,1249.07470703125,1249.7255859375,1250.510986328125,1253.35693359375,1264.595458984375,1267.34814453125,1268.53271484375,1269.32958984375,1270.767578125,1284.62158203125,1285.38916015625,1286.74365234375,1291.260498046875,1298.612548828125,1303.455078125,1304.250244140625,1307.597412109375,1310.5166015625,1312.026123046875,1312.844482421875,1317.6376953125,1318.6796875,1330.560546875,1331.722900390625,1332.4619140625,1335.41748046875,1342.084716796875,1346.169677734375,1346.879638671875,1351.53759765625,1353.498291015625,1354.1474609375,1355.40673828125,1356.172607421875,1358.3251953125,1363.20068359375,1364.0361328125,1365.446533203125,1366.47509765625,1370.895751953125,1381.476806640625,1382.77197265625,1383.983642578125,1391.583984375,1392.693359375,1403.782470703125,1414.3837890625,1419.26953125,1426.4638671875,1429.45703125,1430.0771484375,1437.87744140625,1440.50927734375,1443.558837890625,1444.800537109375,1445.656982421875,1447.188720703125,1455.789794921875,1456.7421875,1457.54541015625,1459.431884765625,1460.559326171875,1467.6767578125,1468.481689453125,1471.0537109375,1478.308837890625,1484.490966796875,1491.760009765625,1498.26220703125,1512.3671875,1541.40185546875,1556.791015625,1557.7734375,1558.563720703125,1560.41650390625,1568.634033203125,1572.3662109375,1573.39111328125,1574.7060546875,1582.7001953125,1585.9091796875,1596.716064453125,1597.572265625,1601.536865234375,1624.675537109375,1651.725341796875,1653.177490234375,1659.3310546875,1668.3681640625,1670.1083984375,1670.958251953125,1672.457275390625,1674.775390625,1683.63525390625,1684.731689453125,1685.38037109375,1686.572998046875,1701.357666015625,1702.643798828125,1709.803955078125,1710.690673828125,1711.67431640625,1715.59619140625,1728.64111328125,1729.6201171875,1745.1513671875,1762.359375,1779.461181640625,1785.56689453125,1798.35546875,1800.76611328125,1802.117431640625,1813.45068359375,1815.147216796875,1836.427001953125,1855.86865234375,1895.4453125,1896.611572265625,1897.65625,1898.346923828125,1938.667236328125,1956.393310546875};
        double[] intensityArray = {9096.0,4135.0,9488.0,18803.0,4188.0,3278.0,4165.0,2375.0,1033.0,7126.0,18488.0,2.0,5079.0,7839.0,4931.0,47397.0,10420.0,15953.0,7495.0,23681.0,15353.0,14228.0,1596.0,3185.0,4573.0,6891.0,7393.0,14459.0,22703.0,1077.0,943.0,7638.0,14504.0,8020.0,7924.0,3384.0,2257.0,21554.0,2404.0,7102.0,7410.0,9422.0,8786.0,11097.0,20477.0,7142.0,20087.0,4873.0,15813.0,19507.0,4133.0,6255.0,16023.0,4221.0,1589.0,14337.0,3920.0,5980.0,2843.0,5265.0,2364.0,8195.0,14093.0,558.0,4637.0,3712.0,10086.0,23119.0,34406.0,4361.0,2951.0,24750.0,6.0,11203.0,1979.0,4082.0,4068.0,3387.0,114029.0,80627.0,4464.0,2011.0,8386.0,5603.0,6854.0,2379.0,10753.0,6954.0,5909.0,13571.0,7111.0,5896.0,3687.0,10389.0,1532.0,4491.0,2900.0,2652.0,2702.0,3456.0,2912.0,33271.0,7629.0,3237.0,13866.0,11421.0,10770.0,2076.0,9055.0,25681.0,7955.0,3468.0,7326.0,16551.0,2846.0,102217.0,4511.0,10252.0,20502.0,13584.0,6712.0,2113.0,5119.0,13806.0,3586.0,10882.0,1644.0,3544.0,6836.0,3110.0,1433.0,5037.0,14570.0,26510.0,6460.0,10097.0,9842.0,20726.0,4.0,16163.0,5238.0,4955.0,58762.0,5987.0,19851.0,8068.0,8555.0,13918.0,2.0,25566.0,14125.0,14701.0,4.0,24745.0,21972.0,4533.0,6401.0,3397.0,2620.0,3940.0,4907.0,5396.0,2684.0,11510.0,10130.0,98677.0,21800.0,8331.0,13106.0,10533.0,3657.0,18781.0,3374.0,743.0,7968.0,7256.0,2720.0,11885.0,2052.0,3727.0,7119.0,22079.0,6373.0,10234.0,36315.0,6327.0,870.0,14906.0,7747.0,2519.0,5656.0,14572.0,19555.0,8552.0,14747.0,6770.0,11806.0,8421.0,10200.0,2427.0,9480.0,8960.0,16381.0,2094.0,5602.0,9160.0,42727.0,28717.0,5607.0,21588.0,10139.0,11133.0,26940.0,28486.0,9748.0,10975.0,18152.0,32169.0,24923.0,5533.0,24394.0,7238.0,1154.0,67128.0,80394.0,9873.0,21168.0,17439.0,6840.0,3693.0,21378.0,18218.0,2090.0,15847.0,11077.0,18992.0,13416.0,11387.0,14975.0,8942.0,12911.0,17317.0,38825.0,16773.0,12412.0,5858.0,27556.0,28315.0,1621.0,6312.0,5331.0,10292.0,7284.0,4086.0,14681.0,39421.0,12018.0,3005.0,13368.0,4195.0,6442.0,7798.0,17872.0,6853.0,41816.0,7.0,10947.0,30763.0,5007.0,21673.0,6290.0,16661.0,69434.0,46068.0,6040.0,52261.0,26523.0,6078.0,23481.0,7341.0,9525.0,5201.0,10350.0,27911.0,7625.0,15824.0,18267.0,32595.0,26808.0,12871.0,147404.0,7538.0,9032.0,8369.0,4271.0,14951.0,35909.0,1.0,11423.0,28420.0,22605.0,26909.0,38189.0,5383.0,23396.0,14982.0,3688.0,6562.0,11089.0,13099.0,18815.0,13127.0,21560.0,62748.0,2923.0,25321.0,8713.0,110876.0,22560.0,11564.0,4767.0,9333.0,7516.0,61489.0,16507.0,5067.0,6314.0,9995.0,5545.0,9698.0,9408.0,25512.0,12089.0,11007.0,3317.0,14860.0,155094.0,80561.0,277.0,11679.0,4106.0,12426.0,12792.0,16095.0,32425.0,41288.0,4172.0,29479.0,3467.0,6293.0,8471.0,21140.0,9899.0,117363.0,48090.0,2443.0,787.0,9336.0,1080.0,21924.0,71188.0,8.0,3053.0,26670.0,10283.0,31824.0,1862.0,16666.0,35393.0,15490.0,5028.0,8664.0,27034.0,45974.0,16439.0,20203.0,36177.0,10702.0,1384.0,19045.0,15125.0,4404.0,6744.0,4232.0,3483.0,1940.0,3107.0,16312.0,16300.0,26595.0,9968.0,12295.0,4365.0,3729.0,14762.0,23496.0,8366.0,27158.0,7930.0,11766.0,6895.0,4111.0,12207.0,18843.0,8.0,9151.0,2434.0,24268.0,7331.0,9156.0,14223.0,6912.0,31783.0,15694.0,9087.0,26686.0,20085.0,24084.0,14017.0,7695.0,6766.0,14849.0,22921.0,5701.0,10987.0,3253.0,19645.0,7781.0,16521.0,4571.0,16078.0,3091.0,8413.0,2027.0,5825.0,15880.0,3585.0,9381.0,3840.0,15797.0,8126.0,7346.0,14359.0,18550.0,12204.0,20298.0,16696.0,4440.0,17828.0,10175.0,10961.0,5648.0,6862.0,20040.0,12195.0,3454.0,4044.0,6821.0,3143.0,8249.0,2645.0,9023.0,4334.0,6917.0,2177.0,5975.0,28057.0,3314.0,8113.0,6826.0,4277.0,5836.0,13207.0,9.0,15039.0,0.0};

        PeakSet peakSet = PeakSet.getInstance(mzArray, intensityArray);
        testMatcher(precursorIon, ProductIonPair.C_Z, peakSet);
    }
}
